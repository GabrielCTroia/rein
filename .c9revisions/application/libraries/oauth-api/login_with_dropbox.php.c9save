{"ts":1357412170584,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<?php\n/*\n * login_with_dropbox.php\n *\n * @(#) $Id: login_with_dropbox.php,v 1.1 2012/10/31 11:05:14 mlemos Exp $\n *\n */\n\n\trequire('http.php');\n\trequire('oauth_client.php');\n\n\t$client = new oauth_client_class;\n\t$client->debug = 1;\n\t$client->debug_http = 1;\n\t$client->server = 'Dropbox';\n\t$client->redirect_uri = 'http://'.$_SERVER['HTTP_HOST'].\n\t\tdirname(strtok($_SERVER['REQUEST_URI'],'?')).'/login_with_dropbox.php';\n\n\t$client->client_id = ''; $application_line = __LINE__;\n\t$client->client_secret = '';\n\n\tif(strlen($client->client_id) == 0\n\t|| strlen($client->client_secret) == 0)\n\t\tdie('Please go to Dropbox Apps page https://www.dropbox.com/developers/apps , '.\n\t\t\t'create an application, and in the line '.$application_line.\n\t\t\t' set the client_id to Consumer key and client_secret with Consumer secret. '.\n\t\t\t'The Callback URL must be '.$client->redirect_uri).' Make sure this URL is '.\n\t\t\t'not in a private network and accessible to the Dropbox site.';\n\n\tif(($success = $client->Initialize()))\n\t{\n\t\tif(($success = $client->Process()))\n\t\t{\n\t\t\tif(strlen($client->access_token))\n\t\t\t{\n\t\t\t\t$success = $client->CallAPI(\n\t\t\t\t\t'https://api.dropbox.com/1/account/info', \n\t\t\t\t\t'GET', array(), array('FailOnAccessError'=>true), $user);\n\t\t\t}\n\t\t}\n\t\t$success = $client->Finalize($success);\n\t}\n\tif($client->exit)\n\t\texit;\n\tif($success)\n\t{\n?>\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">\n<html>\n<head>\n<title>Dropbox OAuth client results</title>\n</head>\n<body>\n<?php\n\t\techo '<h1>', HtmlSpecialChars($user->display_name), \n\t\t\t' you have logged in successfully with Dropbox!</h1>';\n\t\techo '<pre>', HtmlSpecialChars(print_r($user, 1)), '</pre>';\n?>\n</body>\n</html>\n<?php\n\t}\n\telse\n\t{\n?>\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">\n<html>\n<head>\n<title>OAuth client error</title>\n</head>\n<body>\n<h1>OAuth client error</h1>\n<p>Error: <?php echo HtmlSpecialChars($client->error); ?></p>\n</body>\n</html>\n<?php\n\t}\n\n?>"]],"start1":0,"start2":0,"length1":0,"length2":1937}]],"length":1937}
